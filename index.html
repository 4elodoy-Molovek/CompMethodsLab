<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Å–≤—ë–∫–ª—ã</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <!-- CDN fallback for environments without node_modules -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-wrapper">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è —Å–≤—ë–∫–ª—ã</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="config">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </a>
                <a href="#" class="nav-item" data-section="optimization">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-label">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</span>
                </a>
                <a href="#" class="nav-item" data-section="matrices">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-label">–ú–∞—Ç—Ä–∏—Ü—ã</span>
                </a>
                <a href="#" class="nav-item" data-section="results">
                    <span class="nav-icon">üìà</span>
                    <span class="nav-label">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="main-header">
                <h1>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Å–≤—ë–∫–ª—ã</h1>
                <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Å–∞—Ö–∞—Ä–Ω–æ–π —Å–≤—ë–∫–ª—ã</p>
            </header>

            <!-- Configuration Section -->
            <section id="config-section" class="content-section active">
                <div class="section-header">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ —Å–≤—ë–∫–ª—ã</p>
                </div>
                <div class="cards-grid">
                    <div class="card-modern">
                        <div class="card-header-modern">
                            <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                        </div>
                        <div class="card-body-modern">
                            <form id="configForm">
                                <div class="form-group">
                                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏–π (n)</label>
                                    <input type="number" class="form-control-modern" id="n" value="15">
                                </div>
                                <div class="form-group">
                                    <label>–ú–∞—Å—Å–∞ –ø–∞—Ä—Ç–∏–∏ (M)</label>
                                    <input type="number" class="form-control-modern" id="m" value="3000">
                                </div>
                                <div class="form-group">
                                    <label>–ù–∞—á–∞–ª—å–Ω–∞—è —Å–∞—Ö–∞—Ä–∏—Å—Ç–æ—Å—Ç—å –≤ % (a)</label>
                                    <div class="input-group-modern">
                                        <input type="number" class="form-control-modern" id="a_min" placeholder="–ú–∏–Ω" value="12">
                                        <span class="input-separator">-</span>
                                        <input type="number" class="form-control-modern" id="a_max" placeholder="–ú–∞–∫—Å" value="22">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ (Œ≤)</label>
                                    <div class="input-group-modern">
                                        <input type="number" step="0.01" class="form-control-modern" id="beta1" placeholder="–ú–∏–Ω" value="0.90">
                                        <span class="input-separator">-</span>
                                        <input type="number" step="0.01" class="form-control-modern" id="beta2" placeholder="–ú–∞–∫—Å" value="0.99">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card-modern">
                        <div class="card-header-modern">
                            <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤</h3>
                        </div>
                        <div class="card-body-modern">
                            <div class="form-group">
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="distType" id="distUniform" value="uniform" checked>
                                        <span>–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="distType" id="distConc" value="concentrated">
                                        <span>–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group" id="deltaContainer" style="display:none">
                                <label>–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –¥–µ–ª—å—Ç—ã (|Œ≤‚ÇÇ-Œ≤‚ÇÅ| / k)</label>
                                <select class="form-control-modern" id="delta_k">
                                    <option value="4" selected>k = 4 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                                    <option value="3">k = 3</option>
                                    <option value="2">k = 2</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- <div class="card-modern">
                        <div class="card-header-modern">
                            <h3>–î–æ–∑–∞—Ä–∏–≤–∞–Ω–∏–µ</h3>
                        </div>
                        <div class="card-body-modern">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableRipening">
                                    <span>–í–∫–ª—é—á–∏—Ç—å –¥–æ–∑–∞—Ä–∏–≤–∞–Ω–∏–µ</span>
                                </label>
                            </div>
                            <div id="ripeningParams" style="display:none">
                                <div class="form-group">
                                    <label>–°—Ç–∞–¥–∏–∏ –¥–æ–∑–∞—Ä–∏–≤–∞–Ω–∏—è (v)</label>
                                    <input type="number" class="form-control-modern" id="v" value="2">
                                </div>
                                <div class="form-group">
                                    <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π Œ≤ –¥–ª—è –¥–æ–∑–∞—Ä–∏–≤–∞–Ω–∏—è</label>
                                    <input type="number" step="0.01" class="form-control-modern" id="beta_max" value="1.05">
                                </div>
                                <div class="form-group">
                                    <label>–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –¥–µ–ª—å—Ç—ã –¥–ª—è –¥–æ–∑–∞—Ä–∏–≤–∞–Ω–∏—è</label>
                                    <select class="form-control-modern" id="delta_k_ripening">
                                        <option value="4" selected>k = 4 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                                        <option value="3">k = 3</option>
                                        <option value="2">k = 2</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div> -->

                    <div class="card-modern">
                        <div class="card-header-modern">
                            <h3>–ü–æ—Ç–µ—Ä–∏ —Å–∞—Ö–∞—Ä–∞</h3>
                        </div>
                        <div class="card-body-modern">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="useLosses" checked>
                                    <span>–£—á–∏—Ç—ã–≤–∞—Ç—å –ø–æ—Ç–µ—Ä–∏ —Å–∞—Ö–∞—Ä–∞</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>–§—É–Ω–∫—Ü–∏—è —Ä–æ—Å—Ç–∞ —Ä–µ–¥—É—Ü–∏—Ä—É—é—â–∏—Ö –≤–µ—â–µ—Å—Ç–≤ I(t)</label>
                                <select class="form-control-modern" id="growth_base">
                                    <option value="1.029" selected>1.029^(7j-7)</option>
                                    <option value="1.03">1.03^(7j-7)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="action-bar" style="display: flex; gap: 20px; justify-content: center;">
                    <button id="multiSimulateBtn" type="button" class="btn-success-modern">
                        <span>üî•</span> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—ã
                    </button>
                </div>
            </section>

            <!-- Optimization Section -->
            <section id="optimization-section" class="content-section">
                <div class="section-header">
                    <h2>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</h2>
                    <p>–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏</p>
                </div>
                <div class="cards-grid">
                    <div class="card-modern">
                        <div class="card-header-modern">
                            <h3>–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</h3>
                        </div>
                        <div class="card-body-modern">
                            <!-- Optimization is now automatic: buttons removed -->
                            <div id="optResults" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Matrices Section -->
            <section id="matrices-section" class="content-section">
                <div class="section-header">
                    <h2>–ú–∞—Ç—Ä–∏—Ü—ã</h2>
                    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç—Ä–∏—Ü —Å–æ—Å—Ç–æ—è–Ω–∏–π</p>
                </div>
                <div class="tabs-modern">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="matrixC">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–∞—Ö–∞—Ä–∞ (C)</button>
                        <button class="tab-btn" data-tab="matrixL">–ü–æ—Ç–µ—Ä–∏ (L)</button>
                        <button class="tab-btn" data-tab="matrixS">–ß–∏—Å—Ç—ã–π –≤—ã—Ö–æ–¥ (S)</button>
                        <button class="tab-btn" data-tab="matrixB">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (B)</button>
                    </div>
                    <div class="tab-content-modern">
                        <div class="tab-pane-modern active" id="matrixC">
                            <div class="matrix-container-modern" id="containerC">–î–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.</div>
                        </div>
                        <div class="tab-pane-modern" id="matrixL">
                            <div class="matrix-container-modern" id="containerL">–î–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.</div>
                        </div>
                        <div class="tab-pane-modern" id="matrixS">
                            <div class="matrix-container-modern" id="containerS">–î–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.</div>
                        </div>
                        <div class="tab-pane-modern" id="matrixB">
                            <div class="matrix-container-modern" id="containerB">–î–∞–Ω–Ω—ã–µ –µ—â—ë –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="content-section">
                <div class="section-header">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    <p>–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ‚Äî –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º</p>
                </div>

                <!-- Chart container: placed at the top, fixed height so it is fully visible without scrollbars -->
                <div class="cards-grid">
                    <div class="card-modern" style="width:100%;">
                        <div class="card-header-modern">
                            <h3>–ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤</h3>
                        </div>
                        <div class="card-body-modern" style="padding: 12px 20px;">
                            <div id="resultsChartContainer" style="width:100%; height:420px; display:flex; align-items:stretch; justify-content:stretch;">
                                <canvas id="resultsChartCanvas" style="flex:1; width:100%; height:100%;"></canvas>
                            </div>
                            <div class="text-muted" style="margin-top:8px; font-size:13px;">
                                –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ 50 –º–∞—Ç—Ä–∏—Ü–∞–º
                            </div>
                        </div>
                    </div>
                </div>

                <div id="resultsContent" class="cards-grid"></div>
            </section>
        </main>
    </div>

    <!-- Dependencies for Bootstrap Tabs -->
    <script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>
    <script src="node_modules/jquery/dist/jquery.min.js"></script>

    <!-- Try local bootstrap first, then fallback to CDN if it 404s -->
    <script>
      (function(){
        var s = document.createElement('script');
        s.src = 'node_modules/bootstrap/dist/js/bootstrap.bundle.min.js';
        s.onload = function(){ console.log('Loaded local bootstrap'); };
        s.onerror = function(){
          var s2 = document.createElement('script');
          s2.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js';
          document.head.appendChild(s2);
          console.log('Falling back to Bootstrap CDN');
        };
        document.head.appendChild(s);
      })();
    </script>
    <script>if (window.module) module = window.module;</script>

    <!-- Chart.js: try local node_modules first, fallback to CDN if not available -->
    <script>
        (function(){
            var local = 'node_modules/chart.js/dist/chart.umd.min.js';
            var s = document.createElement('script');
            s.src = local;
            s.onload = function(){ console.log('Loaded Chart.js from node_modules'); };
            s.onerror = function(){
                var cdn = 'https://cdn.jsdelivr.net/npm/chart.js';
                var s2 = document.createElement('script');
                s2.src = cdn;
                document.head.appendChild(s2);
                console.log('Falling back to Chart.js CDN');
            };
            document.head.appendChild(s);
        })();
    </script>

    <script src="renderer.js"></script>

    <script>
        // Attach handlers after DOM + renderer.js loaded to avoid calling missing functions/elements
        document.addEventListener('DOMContentLoaded', function () {
            // Single-matrix generation removed per experiment requirements.

            const optBtn = document.getElementById('optBtn');
            if (optBtn) {
                optBtn.addEventListener('click', function () {
                    if (typeof runOptimization === 'function') {
                        try { runOptimization(); } catch (e) { console.error('runOptimization failed', e); }
                    } else {
                        console.warn('runOptimization not defined yet');
                    }
                });
            }

            const multiSimulateBtn = document.getElementById('multiSimulateBtn');
            if (multiSimulateBtn) {
                multiSimulateBtn.addEventListener('click', function () {
                    if (typeof runMultiSimulation === 'function') {
                        try { runMultiSimulation(); } catch (e) { console.error('runMultiSimulation failed', e); }
                    } else {
                        console.warn('runMultiSimulation not defined yet');
                    }
                });
            }

            const multiOptBtn = document.getElementById('multiOptBtn');
            if (multiOptBtn) {
                multiOptBtn.addEventListener('click', function () {
                    if (typeof runMultiOptimization === 'function') {
                        try { runMultiOptimization(); } catch (e) { console.error('runMultiOptimization failed', e); }
                    } else {
                        console.warn('runMultiOptimization not defined yet');
                    }
                });
            }
        });
    </script>

    <script>
        // Sidebar navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                item.classList.add('active');
                const section = item.getAttribute('data-section');
                const target = document.getElementById(section + '-section');
                if (target) target.classList.add('active');
            });
        });

        // Tab switching for matrices
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-pane-modern').forEach(p => p.classList.remove('active'));
                
                btn.classList.add('active');
                const tabId = btn.getAttribute('data-tab');
                const pane = document.getElementById(tabId);
                if (pane) pane.classList.add('active');
            });
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –¥–µ–ª—å—Ç—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–∏–ø–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const deltaContainer = document.getElementById('deltaContainer');
                const uniformRadio = document.getElementById('distUniform');
                const concRadio = document.getElementById('distConc');

                if (uniformRadio && concRadio && deltaContainer) {
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–æ–∫
                    uniformRadio.addEventListener('change', function() {
                        if (this.checked) {
                            deltaContainer.style.display = 'none';
                        }
                    });
                    
                    concRadio.addEventListener('change', function() {
                        if (this.checked) {
                            deltaContainer.style.display = 'block';
                        }
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    if (concRadio.checked) {
                        deltaContainer.style.display = 'block';
                    } else {
                        deltaContainer.style.display = 'none';
                    }
                } else {
                    console.warn('distType radios or deltaContainer not found - skipping delta toggle init');
                }
            } catch (e) {
                console.warn('Error initializing distribution toggle:', e);
            }
        });
        
    </script>
</body>

</html>